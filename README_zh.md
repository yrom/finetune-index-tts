# IndexTTS 微调示例

[English Version](README.md)

本项目是个示例项目，旨在对 [IndexTTS](https://github.com/index-tts/index-tts) 进行微调，使其能够识别并生成带有特殊标签（如 `<GIGGLES>`）的语音音频，实现如笑声等情感或非文本元素的合成。

> [!NOTE]
> 本项目仅为示例，实际应用中请根据具体需求进行调整和优化。  
> 微调详细思路可以查看我的blog：[《微调IndexTTS以输出可控情绪的语言音频》](https://yrom.net/blog/2025/06/15/finetune-indextts-to-generate-controllable-emotions-speech/)

## 项目目标

- 示例如何对 IndexTTS 的文本 Tokenizer和自回归模型部分（GPT2）进行微调
- 支持在文本中插入如 `<GIGGLES>` 等特殊标签，以生成对应的笑声或其他音效。

### 微调数据集

[🤗 MrDragonFox/Elise](https://huggingface.co/datasets/MrDragonFox/Elise)（modelscope 的[镜像](https://www.modelscope.cn/datasets/RealmSky/Elise) ）

### 微调实验结果示例

| 参考音频 | 文本 | 语音 |
| --- | --- | --- |
|[Female-1][Female_1]| Seriously? &lt;giggles> That's the cutest thing I've ever heard! | [Synthesized Speech](samples/Female-1_SeriouslygigglesThatsthecutestt.wav) |
| [Female-1][Female_1] | 真的吗？ &lt;giggles> 这也太可爱了吧！| [Synthesized Speech](samples/Female-1_真的吗giggles这也太可爱了吧.wav) |
| [Male-1][Male_1]| Wha—? Cute? &lt;giggles> You think I'm cute?! Well, uh, thanks, I guess? | [Synthesized Speech](samples/Male-1_Wha—CutegigglesYouthinkImcute.wav) |
| [Male-1][Male_1]| 哎呀! 忘了他还在那等我们呢！&lt;giggles> 我们两个动作得快点了！| [Synthesized Speech](samples/Male-1_哎呀忘了他还在那等我们呢giggles我们两个动作得快点了.wav) |

### IndexTTS 模型架构

```mermaid
flowchart TD
    D("参考文本") -->BPE[[**BPE**]] --> T(文本 Token ID)
    A("参考语音") --> M(Mel-Spectrogram) --> VAE[[*DiscreteVAE*]]--> B(Mel-Spec 编码 ID)
    A -->CE[[*Conformer Encoder*]] --> Pe[[*Perceiver Resampler*]] --> CA(参考语音上下文向量) -->|上下文条件| C
    B --> C
    T --> C[[**GPT2**]]
    C --> L("目标语音的潜在表示
*隐藏状态*")
    L --> V[["*BigVGAN*
    (Generator)"]]
    A --> SP[[*ECAPA-TDNN*]]--> S(说话人 Embedding)
    S --> V
    V -->|合成| PCM("音频波形 (PCM)") --> W("语音音频")
```

### 本项目微调的模块

- **BPE**: 实际为 `sentencepiece`，为它增加新的特殊标签 token，如 `<GIGGLES>` 具体过程请参见 [preprocess_mel_dataset.ipynb](preprocess_mel_dataset.ipynb) 笔记本。
- **GPT2**: 自回归模型部分，使用 [🤗 peft](https://huggingface.co/docs/peft/v0.15.0/en/index) 库进行`LoRA`微调，支持生成带有特殊标签文本的语音 Latent，具体过程请参见 [fine_tune_indextts.ipynb](fine_tune_indextts.ipynb) 笔记本。


## Disclaimer

The reference audio files and the datasets used in this project are granted under the [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/) license.
They are used for the research and demonstration purposes of this project only, and are not intended for any commercial use.
The synthesized audio files generated by this project are also not intended for commercial use.

[Female_1]: https://bytedancespeech.github.io/seedtts_tech_report/audios/SpeechFactorization_samples/prompt/prompt1/4813840990459345930.wav
[Male_1]: https://bytedancespeech.github.io/seedtts_tech_report/audios/SpeechFactorization_samples/source/2188769758301752050.wav

